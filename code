#include <Keypad.h>
#include <SoftwareSerial.h>

SoftwareSerial sim800l(0, 1); // RX, TX (matches your schematic)

// Keypad setup
const byte ROWS = 4;
const byte COLS = 3;
char keys[ROWS][COLS] = {
  {'1','2','3'},
  {'4','5','6'},
  {'7','8','9'},
  {'*','0','#'}
};
byte rowPins[ROWS] = {2, 3, 4, 5};
byte colPins[COLS] = {6, 7, 8};
Keypad keypad = Keypad(makeKeymap(keys), rowPins, colPins, ROWS, COLS);

void setup() {
  Serial.begin(9600);
  sim800l.begin(9600);
  delay(500);
}

void loop() {
  char key = keypad.getKey();
  if (key) {
    String message = getMessageForKey(key);
    if (message != "") {
      SendSMS(message);
      Serial.print("Sent SMS: ");
      Serial.println(message); // This line displays the message in the virtual terminal
    }
  }
  // Display GSM response in virtual terminal
  if (sim800l.available()) {
    Serial.write(sim800l.read());
  }
}

String getMessageForKey(char key) {
  switch(key) {
    case '1': return "Material 1: 29536524";
    case '2': return "Material 2: 29536522";
    case '3': return "Material 3: 29558486";
    case '4': return "Material 4: 29545983";
    case '5': return "Material 5: 29564110";
    case '6': return "Material 6: 29572827";
    case '7': return "Material 7: 29564113";
    case '8': return "Material 8: 29564109";
    case '9': return "Material 9: 29537508";
    case '0': return "Material 10: 28661834";
    case '*': return "Material 11: 29572828";
    case '#': return "Material 12: 29564107";
    default: return "";
  }
}

void SendSMS(String message) {
  sim800l.print("AT+CMGF=1\r");
  delay(100);
  sim800l.print("AT+CMGS=\"+919080659745\"\r"); // Replace with your number
  delay(500);
  sim800l.print(message);
  delay(500);
  sim800l.print((char)26); // Ctrl+Z
  delay(500);
  sim800l.println();
}
